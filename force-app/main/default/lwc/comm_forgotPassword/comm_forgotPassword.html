<template>
    <!-- Only render form after finishing initial loading -->
    <template lwc:if={finishInitialLoad}>
        <section class="comm-forgot-password">
            <!-- Forgot Password - Titles -->
            <div class="comm-forgot-password__title">
                <h1><span>{titleText}</span></h1>
                <span if:true={isEmailInput}>{label.emailInput}</span>
                <span if:true={isEmailSent}>{label.emailInput}</span>
                <span if:true={isPasswordReset}>{label.reset}</span>
                <span if:true={isPasswordDefined}>{label.reset}</span>
            </div>

            <!-- Form error feedback -->
            <div if:true={isFormError} class="comm-forgot-password__feedback">
                <i class="comm-icon__information"></i>
                <span>{errorMessage}</span>
            </div>

            <!-- Forgot Password - Email Input -->
            <form if:true={isEmailInput} class="comm-forgot-password__email-input" novalidate>
                <c-comm_input type="email" label="Email" is-required="true" data-id="email-input"></c-comm_input>
                <lightning-button
                    onclick={handleOnClickResetPassword}
                    type="submit"
                    class="comm-button__primary"
                    label={label.buttonRecover}
                ></lightning-button>
            </form>

            <!-- Forgot Password - Email Sent -->
            <form if:true={isEmailSent} class="comm-forgot-password__email-sent">
                <template lwc:if={isLoading}><lightning-spinner></lightning-spinner></template>
                <div>
                    <i class="comm-icon__check"></i>
                    <span> {label.emailSent} </span>
                </div>
                <lightning-button type="button" class="comm-button__primary" label={label.goToLogin} onclick={navigateToLogin}></lightning-button>
            </form>

            <!-- Register - Password Reset -->
            <form if:true={isPasswordReset} class="comm-forgot-password__password-reset">
                <c-comm_input type="password" label={label.newPassword} is-required="true" onchange={handlePasswordChange}></c-comm_input>
                <c-comm_input type="password" label={label.confirm} is-required="true" onchange={handlePasswordConfirmationChange}></c-comm_input>

                <!-- Password Validator-->
                <c-comm_password-validator
                    password={password}
                    password-confirmation={passwordConfirmation}
                    email={userEmail}
                    first-name={userFirstName}
                    last-name={userLastName}
                    onvalidation={handlePassValidation}
                ></c-comm_password-validator>

                <lightning-button
                    data-name="submit_pass"
                    onclick={handleOnClickChangePassword}
                    type="submit"
                    class="comm-button__primary"
                    label={label.confirmationChange}
                    disabled
                ></lightning-button>
            </form>

            <!-- Forgot Password - Email Sent -->
            <form if:true={isPasswordDefined} class="comm-forgot-password__password-defined">
                <div>
                    <i class="comm-icon__check"></i>
                    <span>{label.success}</span>
                </div>
                <lightning-button type="button" class="comm-button__primary" label={label.goToLogin} onclick={navigateToLogin}></lightning-button>
            </form>
        </section>

        <!-- Login - Image section -->
        <img if:true={pageIllustrationUrl} src={pageIllustrationUrl} alt={pageIllustrationTitle} />
    </template>
    <!-- Loading Spinner -->
    <c-comm_loader is-loading={isLoading}></c-comm_loader>
</template>